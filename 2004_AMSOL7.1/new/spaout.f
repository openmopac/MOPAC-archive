      SUBROUTINE SPAOUT(ENERGY)
       IMPLICIT DOUBLE PRECISION (A-H,O-Z)
       INCLUDE 'SIZES.i'
       INCLUDE 'KEYS.i'                                                 DJG0496
C******************************************************************************
C
C     THIS SUBROUTINE PRINTS A .SPART FILE THAT CAN BE USED BY THE
C     PROGRAM SPARTAN BY WAVEFUNCTION INC. TO CREATE PICTURES OF VARIOUS
C     MOLECULAR PROPERTIES.
C
C     CREATED BY DJG 0395
C
C     NCONTS = # OF CONTRACTED SHELLS
C     NPRIMS = # OF PRIMITIVE SHELLS
C     NUMAT  = # OF ATOMS
C     NORBS  = # OF ATOMIC ORBITALS
C     KHARGE = CHARGE ON SYSTEM
C     ISORB  = S ORBITAL
C     IPORB  = P ORBITAL
C     NBASIS = NUMBER OF BASIS FUNCTIONS
C     BORINV = INVERSE BOHR
C
C
C******************************************************************************
      COMMON /MLKSTI/ NUMAT,NAT(NUMATM),NFIRST(NUMATM),NMIDLE(NUMATM),
     1                NLAST(NUMATM), NORBS, NELECS,NALPHA,NBETA,
     2                NCLOSE,NOPEN,NDUMY
      COMMON /GEOM  / GEO(3,NUMATM)
      COMMON /TRADCM/ ENGAS, IRAD, ICR, ICHMOD, ICHGM, NUMSLV           GDH0897
      COMMON /DENSTY/ P(MPACK), PA(MPACK), PB(MPACK)
      COMMON /VECTOR/ C(MAXORB,MAXORB),EIGS(MAXORB),
     1                CBETA(MAXORB,MAXORB), EIGB(MAXORB)
      DOUBLE PRECISION HYDROG(15), CARBON(30), NITROG(30), OXYGEN(30),
     1                 FLURIN(30), PHOSPH(30), SULFUR(30), CLORIN(30),
     2                 BROMIN(30), IODINE(30), LITHUM(30)
      DIMENSION COORD(3,NUMATM),Q1(NUMATM),Q2(NUMATM),Q3(NUMATM)
      CHARACTER*9 RUNTYP
      CHARACTER*16 BASISS
      CHARACTER*13 OPTION
      CHARACTER*2 C1
      INCLUDE 'PARAMS.i'
      DATA ISP /87/                                                     DJGSPART
      DATA HYDROG / 3.144408261D0, 0.2597237942D0, 0.0000000000D0,
     1 0.0000000000D0, 0.0000000000D0, 0.5727578899D0, 0.2511935464D0,
     2 0.0000000000D0, 0.0000000000D0, 0.0000000000D0, 0.1550106373D0,
     3 0.07828605655D0,0.0000000000D0, 0.0000000000D0, 0.0000000000D0 /
      DATA LITHUM / 1.090716873D0,-0.04559794438D0,0.0000000000D0,
     1 0.0000000000D0, 0.0000000000D0, 0.06623203389D0,0.05546071998D0,
     2 0.0000000000D0, 0.0000000000D0, 0.0000000000D0, 0.02542745385D0,
     3 0.02079323571D0,0.0000000000D0, 0.0000000000D0, 0.0000000000D0,
     4 0.5170713189D0, 0.0000000000D0, 0.1014963479D0, 0.0000000000D0,
     5 0.0000000000D0, 0.1327046908D0, 0.0000000000D0, 0.06463912428D0,
     6 0.0000000000D0, 0.0000000000D0, 0.04505515732D0,0.0000000000D0,
     7 0.01249537189D0,0.0000000000D0, 0.0000000000D0 /
      DATA CARBON / 8.445037597D1,-0.2116471532D0, 0.0000000000D0,
     1 0.0000000000D0, 0.0000000000D0, 0.5128113721D0, 0.2574261550D0,
     2 0.0000000000D0, 0.0000000000D0, 0.0000000000D0, 0.1968758429D0,
     3 0.09651376184D0,0.0000000000D0, 0.0000000000D0, 0.0000000000D0,
     4 2.610282588D0,  0.0000000000D0, 0.7680186434D0, 0.0000000000D0,
     5 0.0000000000D0, 0.6699206301D0, 0.0000000000D0, 0.4891215652D0,
     6 0.0000000000D0, 0.0000000000D0, 0.2274477202D0, 0.0000000000D0,
     7 0.09455195944D0,0.0000000000D0, 0.0000000000D0 /
      DATA NITROG / 13.84016053D0, -0.3065611287D0, 0.0000000000D0,
     1 0.0000000000D0, 0.0000000000D0, 0.8404215651D0, 0.3728698991D0,
     2 0.0000000000D0, 0.0000000000D0, 0.0000000000D0, 0.3226502238D0,
     3 0.1397957276D0, 0.0000000000D0, 0.0000000000D0, 0.0000000000D0,
     4 4.280619766D0,  0.0000000000D0, 1.425265163D0,  0.0000000000D0,
     5 0.0000000000D0, 1.098607294D0,  0.0000000000D0, 0.9076966211D0,
     6 0.0000000000D0, 0.0000000000D0, 0.3729930282D0, 0.0000000000D0,
     7 0.1754665920D0, 0.0000000000D0, 0.0000000000D0 /
      DATA OXYGEN / 24.93769342D0, -0.4767639968D0, 0.0000000000D0,
     1 0.0000000000D0, 0.0000000000D0, 1.514301462D0,  0.5798874244D0,
     2 0.0000000000D0, 0.0000000000D0, 0.0000000000D0, 0.5813626471D0,
     3 0.2174103745D0, 0.0000000000D0, 0.0000000000D0, 0.0000000000D0,
     4 5.856255879D0,  0.0000000000D0, 2.108809793D0,  0.0000000000D0,
     5 0.0000000000D0, 1.502989234D0,  0.0000000000D0, 1.343019933D0,
     6 0.0000000000D0, 0.0000000000D0, 0.5102865317D0, 0.0000000000D0,
     7 0.2596188253D0, 0.0000000000D0, 0.0000000000D0 /
      DATA FLURIN / 36.69331177D0, -0.6369442538D0, 0.0000000000D0,
     1 0.0000000000D0, 0.0000000000D0, 2.228142544D0,  0.7747144610D0,
     2 0.0000000000D0, 0.0000000000D0, 0.0000000000D0, 0.8554167580D0,
     3 0.2904545848D0, 0.0000000000D0, 0.0000000000D0, 0.0000000000D0,
     4 5.720765301D0,  0.0000000000D0, 2.048000310D0,  0.0000000000D0,
     5 0.0000000000D0, 1.468216013D0,  0.0000000000D0, 1.304292709D0,
     6 0.0000000000D0, 0.0000000000D0, 0.4984805214D0, 0.0000000000D0,
     7 0.2521324761D0, 0.0000000000D0, 0.0000000000D0 /
      DATA PHOSPH / 2.214549323D0, -0.2306336360D0, 0.0000000000D0,
     1 0.0000000000D0, 0.0000000000D0, 0.2718161147D0, 0.2310781713D0,
     2 0.0000000000D0, 0.0000000000D0, 0.0000000000D0, 0.1283443982D0,
     3 0.03456647065D0,0.0000000000D0, 0.0000000000D0, 0.0000000000D0,
     4 9.468672350D0,  0.0000000000D0,-0.2514223003D0, 0.0000000000D0,
     5 0.0000000000D0, 0.5236867614D0, 0.0000000000D0, 0.3313832996D0,
     6 0.0000000000D0, 0.0000000000D0, 0.2018145730D0, 0.0000000000D0,
     7 0.1050820293D0, 0.0000000000D0, 0.0000000000D0 /
      DATA SULFUR / 3.159454966D0, -0.3010701887D0, 0.0000000000D0,
     1 0.0000000000D0, 0.0000000000D0, 0.3877948279D0, 0.3016504871D0,
     2 0.0000000000D0, 0.0000000000D0, 0.0000000000D0, 0.1831064867D0,
     3 0.04512322669D0,0.0000000000D0, 0.0000000000D0, 0.0000000000D0,
     4 7.485577050D0,  0.0000000000D0,-0.1874234987D0, 0.0000000000D0,
     5 0.0000000000D0, 0.4140071023D0, 0.0000000000D0, 0.2470306626D0,
     6 0.0000000000D0, 0.0000000000D0, 0.1595470284D0, 0.0000000000D0,
     7 0.07833371012D0,0.0000000000D0, 0.0000000000D0 /
      DATA CLORIN / 7.439368718D0, -0.5722827967D0, 0.0000000000D0,
     1 0.0000000000D0, 0.0000000000D0, 0.9131159465D0, 0.5733858444D0,
     2 0.0000000000D0, 0.0000000000D0, 0.0000000000D0, 0.4311492596D0,
     3 0.08577151555D0,0.0000000000D0, 0.0000000000D0, 0.0000000000D0,
     4 11.61464639D0,  0.0000000000D0,-0.3245636844D0, 0.0000000000D0,
     5 0.0000000000D0, 0.6423748049D0, 0.0000000000D0, 0.4277861772D0,
     6 0.0000000000D0, 0.0000000000D0, 0.2475537029D0, 0.0000000000D0,
     7 0.1356514938D0, 0.0000000000D0, 0.0000000000D0 /
      DATA BROMIN / 2.129347520D0, -0.4207425317D0, 0.0000000000D0,
     1 0.0000000000D0, 0.0000000000D0, 0.4176354772D0, 0.3912714817D0,
     2 0.0000000000D0, 0.0000000000D0, 0.0000000000D0, 0.2061142631D0,
     3 0.02739740936D0,0.0000000000D0, 0.0000000000D0, 0.0000000000D0,
     4 2.019105613D0,  0.0000000000D0,-0.2109163599D0, 0.0000000000D0,
     5 0.0000000000D0, 0.3087107579D0, 0.0000000000D0, 0.2166198166D0,
     6 0.0000000000D0, 0.0000000000D0, 0.1517890605D0, 0.0000000000D0,
     7 0.05310981829D0,0.0000000000D0, 0.0000000000D0 /
      DATA IODINE / 0.4776650293D0, -0.2709818108D0, 0.0000000000D0,
     1 0.0000000000D0, 0.0000000000D0, 0.1949275578D0, 0.1561333867D0,
     2 0.0000000000D0, 0.0000000000D0, 0.0000000000D0, 0.1154504055D0,
     3 0.1008787139D0, 0.0000000000D0, 0.0000000000D0, 0.0000000000D0,
     4 0.9936581231D0, 0.0000000000D0,-0.1964961992D0, 0.0000000000D0,
     5 0.0000000000D0, 0.2209021308D0, 0.0000000000D0, 0.1743505977D0,
     6 0.0000000000D0, 0.0000000000D0, 0.1216623785D0, 0.0000000000D0,
     7 0.02792003718D0,0.0000000000D0, 0.0000000000D0 /
      SAVE
      IF (I1SCF.NE.0) THEN
         OPTION='NOOPT        '
      ELSE
         OPTION='OPT          '
      ENDIF
      MULT=1
      IF (IUHF.NE.0) THEN
         RUNTYP='UHF      '
         MULT=ABS(NALPHA-NBETA)+1
      ELSE
         RUNTYP='RHF      '
         IF(IDOUBL.NE.0) MULT=2
         IF(ITRIPL.NE.0) MULT=3
         IF(IQUART.NE.0) MULT=4
         IF(IQUINT.NE.0) MULT=5
         IF(ISEXTE.NE.0) MULT=6
         MULT=ABS(NALPHA-NBETA)+(NOPEN-NCLOSE)+1
      ENDIF
      IF (IAM1.NE.0) THEN
         BASISS='AM1             '
      ELSE IF (IPM3.NE.0) THEN
         BASISS='PM3             '
      ELSE
         BASISS='MNDO            '
      ENDIF
      C1='  '
      NCONTS=0
      NPRIMS=0
      KHARGE=0
      NZERO=0
      ISORB=0
      IPORB=1
      NBASIS=3
      BORINV=1/0.529177D0
      DO 10 I=1,NUMAT
         IF (NAT(I).NE.1) THEN
            NCONTS=NCONTS+2
            NPRIMS=NPRIMS+6
         ELSE
            NCONTS=NCONTS+1
            NPRIMS=NPRIMS+3
         ENDIF
 10   CONTINUE
      IF(ICHARG.NE.0) KHARGE=IICHAR
      CALL GMETRY(GEO,COORD)
      OPEN (UNIT=ISP,STATUS='UNKNOWN')
      WRITE(ISP,900)
      WRITE(ISP,910) BASISS
      WRITE(ISP,920) KHARGE, MULT
      DO 15 I=1,NUMAT
         WRITE(ISP,1040) NAT(I), COORD(1,I), COORD(2,I), COORD(3,I)
 15   CONTINUE
      WRITE(ISP,930)
      IF (ICHMOD.EQ.1) THEN
         WRITE(ISP,1200)
         CALL CHGMP1(P,Q2)                                              DL0397
         DO 18 I=1,NUMAT
            Q1(I)=ZHELP(NAT(I))-Q2(I)                                   DL0397
18       CONTINUE
         WRITE(ISP,1210) (Q2(J), J=1,NUMAT)
         WRITE(ISP,1220)
      ELSE IF (ICHMOD.EQ.2) THEN                                        GDH0997
         WRITE(ISP,1200)                                                GDH0997
         CALL CHGMP2(P,Q2)                                              GDH0997
         DO 19 I=1,NUMAT                                                GDH0997
            Q1(I)=ZHELP(NAT(I))-Q2(I)                                   GDH0997
19       CONTINUE                                                       GDH0997
         WRITE(ISP,1210) (Q2(J), J=1,NUMAT)                             GDH0997
         WRITE(ISP,1220)                                                GDH0997
      ENDIF
      WRITE(ISP,940)
      WRITE(ISP,1000)
      WRITE(ISP,1020) NUMAT, NORBS, NCONTS, NPRIMS, KHARGE, MULT, NORBS
     1              , NZERO, RUNTYP, BASISS, OPTION, C1
      WRITE(ISP,1030)
      DO 20 I=1,NUMAT
         WRITE(ISP,1040) NAT(I),COORD(1,I)*BORINV,COORD(2,I)*BORINV,
     1                   COORD(3,I)*BORINV
 20   CONTINUE
      WRITE(ISP,1050)
      ICOUNT=1
      DO 30 I=1,NUMAT
         WRITE(ISP,1060) ISORB, NBASIS, ICOUNT, I, ISORB
         ICOUNT=ICOUNT+3
         IF (NAT(I).NE.1) THEN
             WRITE(ISP,1060) IPORB, NBASIS, ICOUNT, I, IPORB
             ICOUNT=ICOUNT+3
         ENDIF
 30   CONTINUE
      DO 40 I=1,NUMAT
         IF (NAT(I).EQ.1) THEN
            WRITE(ISP,1070) HYDROG
         ELSE IF (NAT(I).EQ.3) THEN
            WRITE(ISP,1070) LITHUM
         ELSE IF (NAT(I).EQ.6) THEN
            WRITE(ISP,1070) CARBON
         ELSE IF (NAT(I).EQ.7) THEN
            WRITE(ISP,1070) NITROG
         ELSE IF (NAT(I).EQ.8) THEN
            WRITE(ISP,1070) OXYGEN
         ELSE IF (NAT(I).EQ.9) THEN
            WRITE(ISP,1070) FLURIN
         ELSE IF (NAT(I).EQ.15) THEN
            WRITE(ISP,1070) PHOSPH
         ELSE IF (NAT(I).EQ.16) THEN
            WRITE(ISP,1070) SULFUR
         ELSE IF (NAT(I).EQ.17) THEN
            WRITE(ISP,1070) CLORIN
         ELSE IF (NAT(I).EQ.35) THEN
            WRITE(ISP,1070) BROMIN
         ELSE IF (NAT(I).EQ.53) THEN
            WRITE(ISP,1070) IODINE
         ELSE
            WRITE(ISP,1080) NAT(I)
            WRITE(6,1080) NAT(I)
            RETURN
         ENDIF
 40   CONTINUE
      WRITE(ISP,1090)
      WRITE(ISP,1100) ENERGY,0.0D0
      WRITE(ISP,1110)
      NLINE=3
      DO 50 I=1,NORBS,4
         NDIFFR=NORBS-I
         IF (NDIFFR.LT.3) NLINE=NDIFFR
         WRITE(ISP,1120) (EIGS(I+J),J=0,NLINE)
 50   CONTINUE
      DO 70 NORBIT=1,NORBS
         NLINE=3
         DO 60 I=1,NORBS,4
            NDIFFR=NORBS-I
            IF (NDIFFR.LT.3) NLINE=NDIFFR
            WRITE(ISP,1120) (C(I+J,NORBIT),J=0,NLINE)
 60      CONTINUE
 70   CONTINUE
      IF (IUHF.NE.0) THEN
         NLINE=3
         WRITE(ISP,1130)
         DO 80 I=1,NORBS,4
            NDIFFR=NORBS-I
            IF (NDIFFR.LT.3) NLINE=NDIFFR
            WRITE(ISP,1120) (EIGB(I+J),J=0,NLINE)
 80      CONTINUE
         DO 100 NORBIT=1,NORBS
            NLINE=3
            DO 90 I=1,NORBS,4
               NDIFFR=NORBS-I
               IF (NDIFFR.LT.3) NLINE=NDIFFR
               WRITE(ISP,1120) (CBETA(I+J,NORBIT),J=0,NLINE)
 90         CONTINUE
100      CONTINUE
      ENDIF
      WRITE(ISP,1300)
      WRITE(ISP,1310)
      CALL CHRGE(P,Q1)
      WRITE(ISP,1320)
      WRITE(ISP,1330) NUMAT
      DO 110 I=1,NUMAT
         WRITE(ISP,1040) NAT(I), COORD(1,I), COORD(2,I), COORD(3,I)
110   CONTINUE
      IF (ICHMOD.GE.1) THEN                                             GDH0997
         WRITE(ISP,1360)
         WRITE(ISP,1350) (Q2(J), J=1,NUMAT)
      ENDIF
      WRITE(ISP,1340)
      DO 120 I=1,NUMAT
         Q3(I)=ZHELP(NAT(I))-Q1(I)
120   CONTINUE
      WRITE(ISP,1350) (Q3(J), J=1,NUMAT)
      WRITE(ISP,1370)
      IF (ICHMOD.GE.1) THEN                                             GDH0997
         WRITE(ISP,1380) ' ELCHARGE MULPOP'
      ELSE
         WRITE(ISP,1390) ' MULPOP'
      ENDIF
900   FORMAT('***********************   BEGIN INPUT FILE HERE  ******',
     1       '***********************')
910   FORMAT(A9)
920   FORMAT(/,I2,I2)
930   FORMAT('ENDCART')
940   FORMAT('***********************   BEGIN ARCIVE FILE HERE  ****',
     1       '***************************')
1000  FORMAT(10X,'AMSOL OUTPUT FOR SPARTAN CALCULATIONS')
1020  FORMAT(/,8I4,1x,A9,A16,A14,A2)
1030  FORMAT('GEOMETRY')
1040  FORMAT(I3,3F14.7)
1050  FORMAT('BASIS')
1060  FORMAT(5I4)
1070  FORMAT(F19.10,/,4F19.10)
1080  FORMAT('INVALID ELEMENT TYPE,',I3,' SPARTAN FILE ABANDONED!')
1090  FORMAT('ENERGY')
1100  FORMAT(2F19.10)
1110  FORMAT('WAVEFUNCTION')
1120  FORMAT(4F19.10)
1130  FORMAT('BETA')
1200  FORMAT('CHARGES')
1210  FORMAT(6F12.6)
1220  FORMAT('ENDCHARGES')
1300  FORMAT('*********************   BEGIN PROPARC FILE HERE  ******',
     1       '***********************')
1310  FORMAT(5X,'AMSOL OUTPUT FOR SPARTAN - CHARGES ARE MULLIKEN '
     1          ,'CHARGES')
1320  FORMAT(/,'GEOMETRY')
1330  FORMAT(I4)
1340  FORMAT('MULLIKEN')
1350  FORMAT(6F12.6)
1360  FORMAT('CHELP')
1370  FORMAT('*********************   BEGIN PROPIN FILE HERE  ******',
     1       '***********************')
1380  FORMAT(A16)
1390  FORMAT(A7)
      CLOSE (ISP)
      RETURN
      END
